<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leon's Snake Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    #gameContainer {
      border: 1px solid black;
      background-color: #f0f0f0;
    }
    .row {
      display: flex;
    }
    .cell {
      width: 20px;
      height: 20px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    .snake {
      background-color: green;
    }
    .food {
      background-color: red;
    }
    .wall {
      background-color: black;
    }
  </style>
</head>
<body>
  <h1>Leon's Snake Game</h1>
  <div id="gameContainer"></div>
  <div id="score"></div>
  <script>
    const container = document.getElementById('gameContainer');
    const scoreDisplay = document.getElementById('score');
    const grid = [];
    const rows = 20;
    const cols = 20;
    let snake = [{x: 9, y: 10}]; // Initial position of the snake
    let food = {x: Math.floor(Math.random() * cols), y: Math.floor(Math.random() * rows)}; // Initial position of the food
    let walls = []; // Array to store active walls
    let score = 0;
    let highestScore = localStorage.getItem('highestScore') || 0;
    let direction;
    let wallSpawnInterval;
    let snakeSpeed = 100; // Initial snake speed

    scoreDisplay.textContent = `Score: ${score} | Highest Score: ${highestScore}`;

    // Create grid
    for (let i = 0; i < rows; i++) {
      const row = document.createElement('div');
      row.classList.add('row');
      grid.push([]);
      for (let j = 0; j < cols; j++) {
        const cell = document.createElement('div');
        cell.classList.add('cell');
        grid[i].push(cell);
        row.appendChild(cell);
      }
      container.appendChild(row);
    }

    // Event listener for arrow key and WASD presses
    document.addEventListener('keydown', directionHandler);

    function directionHandler(event) {
      if ((event.keyCode === 37 || event.key === 'a') && direction !== 'RIGHT') {
        direction = 'LEFT';
      } else if ((event.keyCode === 38 || event.key === 'w') && direction !== 'DOWN') {
        direction = 'UP';
      } else if ((event.keyCode === 39 || event.key === 'd') && direction !== 'LEFT') {
        direction = 'RIGHT';
      } else if ((event.keyCode === 40 || event.key === 's') && direction !== 'UP') {
        direction = 'DOWN';
      }
    }

    // Function to draw on grid
    function draw() {
      // Clear grid
      for (let i = 0; i < rows; i++) {
        for (let j = 0; j < cols; j++) {
          grid[i][j].classList.remove('snake', 'food', 'wall');
        }
      }

      // Draw snake
      snake.forEach((segment) => {
        grid[segment.y][segment.x].classList.add('snake');
      });

      // Draw food
      grid[food.y][food.x].classList.add('food');

      // Draw walls
      walls.forEach((wall) => {
        grid[wall.y][wall.x].classList.add('wall');
      });

      // Move snake
      let snakeX = snake[0].x;
      let snakeY = snake[0].y;

      if (direction === 'LEFT') snakeX -= 1;
      if (direction === 'UP') snakeY -= 1;
      if (direction === 'RIGHT') snakeX += 1;
      if (direction === 'DOWN') snakeY += 1;

      // If snake eats the food
      if (snakeX === food.x && snakeY === food.y) {
        score++;
        if (score > highestScore) {
          highestScore = score;
          localStorage.setItem('highestScore', highestScore);
        }
        food = {x: Math.floor(Math.random() * cols), y: Math.floor(Math.random() * rows)};
      } else {
        snake.pop();
      }

      // If snake hits the wall
      if (collision({x: snakeX, y: snakeY}, walls)) {
        clearInterval(game);
        clearInterval(wallSpawnInterval);
        alert('Game Over! Your score: ' + score);
        location.reload();
      }

      // Create new head of the snake
      const newHead = {
        x: snakeX,
        y: snakeY
      };

      // Game over conditions
      if (
        snakeX < 0 || snakeX >= cols || 
        snakeY < 0 || snakeY >= rows ||
        collision(newHead, snake)
      ) {
        clearInterval(game);
        clearInterval(wallSpawnInterval);
        alert('Game Over! Your score: ' + score);
        location.reload();
      }

      snake.unshift(newHead);
      scoreDisplay.textContent = `Score: ${score} | Highest Score: ${highestScore}`;
    }

    // Function to check collision
    function collision(head, array) {
      return array.some((segment) => {
        return (head.x === segment.x && head.y === segment.y);
      });
    }

    // Function to spawn wall
    function spawnWall() {
      walls = []; // Clear existing walls
      for (let i = 0; i < 5; i++) {
        let wall;
        do {
          wall = {x: Math.floor(Math.random() * cols), y: Math.floor(Math.random() * rows)};
        } while (collision(wall, walls)); // Ensure unique wall positions
        walls.push(wall);
      }
    }

    // Despawn walls after a certain time
    function moveWalls() {
      spawnWall();
      setTimeout(moveWalls, 5000); // Walls respawn after 5 seconds
    }

    // Game loop
    let game = setInterval(draw, 100);
    wallSpawnInterval = setInterval(moveWalls, 5000); // Change spawn time here
  </script>
</body>
</html>
